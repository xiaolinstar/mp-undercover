# è°æ˜¯å§åº•æ¸¸æˆ

åŸºäºå¾®ä¿¡å…¬ä¼—å·çš„æ–‡å­—ç‰ˆ"è°æ˜¯å§åº•"æ¸¸æˆï¼Œä½¿ç”¨Flask + Rediså®ç°ï¼Œé€šè¿‡Docker Composeéƒ¨ç½²ã€‚

## é¡¹ç›®ç‰¹è‰²

- ğŸ® åŸºäºå¾®ä¿¡å…¬ä¼—å·çš„äº’åŠ¨æ¸¸æˆ
- ğŸ—ï¸ é¢å‘å¯¹è±¡è®¾è®¡ï¼Œæ¨¡å—åŒ–æ¶æ„
- ğŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²
- ğŸ“Š Redisæ•°æ®å­˜å‚¨
- ğŸ”§ çµæ´»çš„é…ç½®ç®¡ç†
- ğŸ§ª å®Œæ•´çš„æµ‹è¯•è¦†ç›–

## æŠ€æœ¯æ¶æ„

### æ–°ç‰ˆæ¶æ„ç‰¹ç‚¹

1. **åˆ†å±‚æ¶æ„è®¾è®¡**ï¼š

   - æ¨¡å‹å±‚ï¼ˆModelsï¼‰ï¼šæˆ¿é—´ã€ç”¨æˆ·ç­‰æ ¸å¿ƒå®ä½“
   - æœåŠ¡å±‚ï¼ˆServicesï¼‰ï¼šæ¸¸æˆé€»è¾‘ã€æ¶ˆæ¯å¤„ç†
   - ä»“å‚¨å±‚ï¼ˆRepositoriesï¼‰ï¼šæ•°æ®è®¿é—®æŠ½è±¡
   - é…ç½®å±‚ï¼ˆConfigï¼‰ï¼šæ¸¸æˆè§„åˆ™å’Œé…ç½®
   - å·¥å…·å±‚ï¼ˆUtilsï¼‰ï¼šè¾…åŠ©å·¥å…·ç±»
2. **è®¾è®¡æ¨¡å¼åº”ç”¨**ï¼š

   - å·¥å‚æ¨¡å¼ï¼šåº”ç”¨åˆ›å»º
   - ä»“å‚¨æ¨¡å¼ï¼šæ•°æ®è®¿é—®
   - æœåŠ¡æ¨¡å¼ï¼šä¸šåŠ¡é€»è¾‘å°è£…
   - é…ç½®æ¨¡å¼ï¼šå‚æ•°ç®¡ç†
3. **ç°ä»£åŒ–ç‰¹æ€§**ï¼š

   - ç±»å‹æç¤º
   - æ•°æ®ç±»ï¼ˆdataclassï¼‰
   - æšä¸¾ç±»å‹
   - å¼‚å¸¸å¤„ç†

## ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.py            # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ app_factory.py     # åº”ç”¨å·¥å‚
â”‚   â”œâ”€â”€ models/           # æ¨¡å‹å±‚
â”‚   â”‚   â”œâ”€â”€ room.py       # æˆ¿é—´æ¨¡å‹
â”‚   â”‚   â””â”€â”€ user.py       # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ services/         # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ game_service.py   # æ¸¸æˆæœåŠ¡
â”‚   â”‚   â””â”€â”€ message_service.py # æ¶ˆæ¯æœåŠ¡
â”‚   â”œâ”€â”€ repositories/      # ä»“å‚¨å±‚
â”‚   â”‚   â”œâ”€â”€ room_repository.py # æˆ¿é—´ä»“å‚¨
â”‚   â”‚   â””â”€â”€ user_repository.py # ç”¨æˆ·ä»“å‚¨
â”‚   â”œâ”€â”€ config/           # é…ç½®å±‚
â”‚   â”‚   â””â”€â”€ game_config.py    # æ¸¸æˆé…ç½®
â”‚   â””â”€â”€ utils/            # å·¥å…·å±‚
â”‚       â””â”€â”€ word_generator.py # è¯è¯­ç”Ÿæˆå™¨
â”œâ”€â”€ tests/                  # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ README.md          # æµ‹è¯•è¯´æ˜
â”‚   â”œâ”€â”€ conftest.py        # æµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ unit/              # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ integration/       # é›†æˆæµ‹è¯•
â”œâ”€â”€ docs/                   # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ architecture.md    # æ¶æ„è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ state_machine.md   # çŠ¶æ€æœºæ–‡æ¡£
â”œâ”€â”€ Dockerfile             # Dockeræ„å»ºæ–‡ä»¶
â”œâ”€â”€ Dockerfile.test        # æµ‹è¯•Dockeræ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml     # Docker Composeé…ç½®
â”œâ”€â”€ nginx.conf             # Nginxé…ç½®
â”œâ”€â”€ requirements.txt       # Pythonä¾èµ–
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ .gitignore             # Gitå¿½ç•¥æ–‡ä»¶
```

## éƒ¨ç½²æ–¹å¼

### Docker Composeéƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. å¤åˆ¶ç¯å¢ƒå˜é‡é…ç½®
cp .env.example .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å†™å®é™…çš„å¾®ä¿¡é…ç½®ä¿¡æ¯

# 2. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 3. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 4. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### æ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. å¯åŠ¨RedisæœåŠ¡å™¨
./start_redis.sh

# 3. é…ç½®ç¯å¢ƒå˜é‡
export WECHAT_TOKEN=your_token_here
export WECHAT_APP_ID=your_app_id_here
export WECHAT_APP_SECRET=your_app_secret_here
export REDIS_URL=redis://localhost:6379/0

# 4. å¯åŠ¨åº”ç”¨
python src/main.py
```

## æµ‹è¯•è¿è¡Œ

### Dockerç¯å¢ƒæµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./test_docker.sh

# æˆ–è€…æ‰‹åŠ¨è¿è¡Œ
docker-compose build test
docker-compose run --rm test

# è¿è¡Œç‰¹å®šæµ‹è¯•
docker-compose run --rm test python -m pytest tests/unit/src/models/test_room.py -v
```

### æœ¬åœ°ç¯å¢ƒæµ‹è¯•

```bash
# ç¡®ä¿å·²å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨RedisæœåŠ¡å™¨
./start_redis.sh

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./run_tests.sh

# æˆ–è€…ç›´æ¥è¿è¡Œ
python -m pytest tests/

# è¿è¡Œå•å…ƒæµ‹è¯•
python -m pytest tests/unit/

# è¿è¡Œé›†æˆæµ‹è¯•
python -m pytest tests/integration/

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest tests/ --cov=src --cov-report=html
```

## ç¯å¢ƒå˜é‡é…ç½®

```bash
# å¾®ä¿¡å…¬ä¼—å·é…ç½®
WECHAT_TOKEN=your_token_here
WECHAT_APP_ID=your_app_id_here
WECHAT_APP_SECRET=your_app_secret_here

# Redisé…ç½®
REDIS_URL=redis://redis:6379/0

# åº”ç”¨å¯†é’¥
SECRET_KEY=your_secret_key_here
```

## æ¸¸æˆä½¿ç”¨è¯´æ˜

### åŸºæœ¬å‘½ä»¤

1. **åˆ›å»ºæˆ¿é—´**ï¼šå‘é€"åˆ›å»ºæˆ¿é—´"
2. **åŠ å…¥æˆ¿é—´**ï¼šå‘é€"åŠ å…¥æˆ¿é—´+æˆ¿é—´å·"ï¼ˆå¦‚"åŠ å…¥æˆ¿é—´1234"ï¼‰
3. **å¼€å§‹æ¸¸æˆ**ï¼šæˆ¿ä¸»å‘é€"å¼€å§‹æ¸¸æˆ"
4. **æŸ¥çœ‹çŠ¶æ€**ï¼šå‘é€"æŸ¥çœ‹çŠ¶æ€"
5. **æŸ¥çœ‹è¯è¯­**ï¼šå‘é€"æŸ¥çœ‹è¯è¯­"
6. **æŠ•ç¥¨æ·˜æ±°**ï¼šæˆ¿ä¸»å‘é€"t+åºå·"ï¼ˆå¦‚"t2"è¡¨ç¤ºæŠ•ç¥¨ç»™2å·ç©å®¶ï¼‰
7. **æŸ¥çœ‹å¸®åŠ©**ï¼šå‘é€"è°æ˜¯å§åº•"æˆ–"å¸®åŠ©"

### æ¸¸æˆè§„åˆ™

- è‡³å°‘3äººå‚ä¸ï¼Œæœ€å¤š12äºº
- æ ¹æ®äººæ•°åˆ†é…å§åº•æ•°é‡ï¼š
  - 3-5äººï¼š1ä¸ªå§åº•
  - 6-8äººï¼š2ä¸ªå§åº•
  - 9-12äººï¼š3ä¸ªå§åº•
- ç©å®¶é€šè¿‡çº¿ä¸‹æè¿°è¯è¯­è¿›è¡Œæ¸¸æˆ
- æˆ¿ä¸»è´Ÿè´£æœ€ç»ˆæŠ•ç¥¨å†³å®šæ·˜æ±°ç©å®¶
- æ¸¸æˆç›®æ ‡ï¼š
  - å¹³æ°‘ï¼šæ‰¾å‡ºæ‰€æœ‰å§åº•
  - å§åº•ï¼šæ··æ·†è§†å¬ï¼Œç”Ÿå­˜åˆ°æœ€å

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

- éµå¾ªPEP 8ä»£ç é£æ ¼
- ä½¿ç”¨ç±»å‹æç¤º
- ç¼–å†™å•å…ƒæµ‹è¯•
- ä¿æŒå‡½æ•°ç®€æ´å•ä¸€èŒè´£

### æµ‹è¯•è¿è¡Œ

```bash
# å¯åŠ¨ Redis æœåŠ¡

docker compose -f docker-compose-dev.yml up -d

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest tests/

# è¿è¡Œå•å…ƒæµ‹è¯•
python -m pytest tests/unit/

# è¿è¡Œé›†æˆæµ‹è¯•
python -m pytest tests/integration/

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest tests/ --cov=src --cov-report=html
```

## é¡¹ç›®æ–‡æ¡£

- [æ¶æ„è®¾è®¡æ–‡æ¡£](docs/architecture.md)ï¼šè¯¦ç»†ä»‹ç»é¡¹ç›®æ¶æ„å’Œè®¾è®¡æ¨¡å¼
- [çŠ¶æ€æœºæ–‡æ¡£](docs/state_machine.md)ï¼šæ¸¸æˆçŠ¶æ€è½¬æ¢å›¾å’Œè¯´æ˜
- [æµ‹è¯•è¯´æ˜](tests/README.md)ï¼šæµ‹è¯•ç»“æ„å’Œè¿è¡Œæ–¹æ³•

## è®¸å¯è¯

MIT License
